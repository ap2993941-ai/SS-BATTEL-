<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Free Fire Tournaments</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary:   #F8FAFC;
      --bg-secondary: #E2E8F0;
      --text-dark:    #1E293B;
      --accent-blue:  #2563EB;
      --accent-gold:  #FBBF24;
      --accent-red:   #DC2626;
      --border:       #CBD5E1;
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg-primary);
      color: var(--text-dark);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .brand {
      font-family: 'Russo One', system-ui;
      letter-spacing: 0.5px;
    }
    header.app-header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: rgba(248,250,252,0.8);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
    }
    header .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    header .logo svg { width: 28px; height: 28px; }
    header .cta-btn {
      background: var(--accent-blue);
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 10px;
      font-weight: 600;
      transition: transform 0.15s ease, opacity 0.15s ease;
    }
    header .cta-btn:active { transform: scale(0.98); }
    main { padding: 12px 12px 80px; }

    /* Cards */
    .card {
      background: white;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 14px;
    }
    .card + .card { margin-top: 12px; }

    /* Hero */
    .hero {
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 8px;
      padding: 14px;
      background: linear-gradient(180deg, #ffffff, var(--bg-secondary));
      border: 1px solid var(--border);
      border-radius: var(--radius);
    }
    .hero .title { font-size: 22px; margin: 0; }
    .hero .subtitle { margin: 4px 0 10px; color: #334155; font-size: 14px; }
    .hero .play-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--accent-gold);
      color: #1f2937;
      border: 0;
      padding: 10px 14px;
      border-radius: 10px;
      font-weight: 800;
      letter-spacing: 0.3px;
      transition: opacity 0.15s ease, transform 0.15s ease;
    }
    .hero .play-btn:active { transform: translateY(1px); }

    /* Tabs */
    .tabs { display: flex; gap: 8px; margin-bottom: 10px; }
    .tab-btn {
      flex: 1;
      background: white;
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 8px 12px;
      font-weight: 600;
      color: #475569;
    }
    .tab-btn.active { background: var(--accent-blue); color: #fff; border-color: var(--accent-blue); }

    /* Tournament card */
    .tourn-card { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; }
    .tourn-meta { font-size: 12px; color: #475569; display: flex; flex-wrap: wrap; gap: 8px; }
    .pill { background: var(--bg-secondary); padding: 4px 8px; border-radius: 999px; border: 1px solid var(--border); }
    .join-btn { background: var(--accent-blue); color: #fff; border: 0; border-radius: 10px; padding: 10px 12px; font-weight: 700; }
    .join-btn[disabled] { opacity: 0.6; }

    /* Profile */
    .profile {
      display: grid; grid-template-columns: auto 1fr; gap: 12px; align-items: center;
    }
    .avatar { width: 64px; height: 64px; border-radius: 50%; background: linear-gradient(135deg, #c7d2fe, #fbcfe8); display: grid; place-items: center; font-weight: 900; color: #1f2937; }
    .input { width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: 10px; background: white; }
    .label { font-size: 12px; color: #475569; margin: 6px 0 4px; }
    .row { display: flex; gap: 8px; align-items: center; }
    .btn { background: #fff; border: 1px solid var(--border); border-radius: 10px; padding: 10px 12px; font-weight: 600; }
    .btn.primary { background: var(--accent-blue); color: #fff; border-color: var(--accent-blue); }
    .btn.danger { background: var(--accent-red); color: #fff; border-color: var(--accent-red); }
    .wallet { display: flex; justify-content: space-between; align-items: center; padding: 12px; border: 1px dashed var(--border); border-radius: 12px; background: #fff; }

    /* Bottom nav */
    nav.bottom {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      background: #fff;
      border-top: 1px solid var(--border);
      display: grid; grid-template-columns: repeat(4, 1fr);
      z-index: 10;
    }
    nav.bottom button {
      appearance: none;
      background: transparent; border: 0; padding: 8px 6px;
      display: grid; gap: 2px; place-items: center; color: #475569; font-size: 11px;
    }
    nav.bottom button.active { color: var(--accent-blue); font-weight: 800; }

    /* Modal */
    .modal-backdrop { position: fixed; inset: 0; background: rgba(15,23,42,0.45); display: none; align-items: flex-end; justify-content: center; z-index: 50; }
    .modal {
      width: 100%; max-width: 520px; background: #fff; border-radius: 16px 16px 0 0; border-top: 4px solid var(--accent-blue); padding: 16px; max-height: 88vh; overflow: auto;
    }
    .modal.open { display: flex; }

    /* Simple success micro-animation */
    .checkmark {
      width: 64px; height: 64px; border-radius: 50%; background: #d1fae5; border: 2px solid #34d399; display: grid; place-items: center; margin: 10px auto;
      animation: pop 450ms ease;
    }
    @keyframes pop { 0% { transform: scale(0.6); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

    /* Utilities */
    .hidden { display: none !important; }
    .mt-8 { margin-top: 8px; }
    .mt-12 { margin-top: 12px; }
    .mt-16 { margin-top: 16px; }
    .section-title { font-family: 'Russo One'; font-size: 16px; letter-spacing: 0.4px; margin: 4px 0 10px; }

    /* Desktop tweaks */
    @media (min-width: 760px) {
      main { padding-left: 18px; padding-right: 18px; max-width: 820px; margin: 0 auto; }
      header.app-header { padding-left: 18px; padding-right: 18px; }
      .hero { grid-template-columns: 1fr 180px; }
    }
  </style>
</head>
<body>
  <header class="app-header">
    <div class="logo">
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M3 12l7-7 7 7-7 7-7-7z" stroke="#1E293B" stroke-width="1.5"/><path d="M10 12l3-3 3 3-3 3-3-3z" fill="#2563EB"/></svg>
      <div class="brand">Free Fire Tournaments</div>
    </div>
    <button class="cta-btn" id="playNowTop">Play Now</button>
  </header>

  <main>
    <!-- Home -->
    <section id="home" class="card">
      <div class="hero">
        <div>
          <h1 class="title brand">Free Fire Tournaments</h1>
          <p class="subtitle">Compete daily. Win prizes. Team up with friends.</p>
          <button class="play-btn" id="playNow">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 5v14l11-7L8 5z" fill="#1E293B"/></svg>
            Play Now
          </button>
        </div>
        <svg width="120" height="80" viewBox="0 0 120 80" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <rect x="2" y="10" width="116" height="60" rx="10" fill="#e2e8f0" stroke="#cbd5e1"/>
          <circle cx="60" cy="40" r="18" fill="#2563eb" opacity="0.14"/>
          <path d="M54 34l14 6-14 6V34z" fill="#2563eb"/>
        </svg>
      </div>
    </section>

    <!-- Tournaments -->
    <section id="tournaments" class="mt-12">
      <div class="section-title">Live Tournaments</div>
      <div class="tabs">
        <button class="tab-btn active" data-tab="live">Live</button>
        <button class="tab-btn" data-tab="upcoming">Upcoming</button>
        <button class="tab-btn" data-tab="past">Past</button>
      </div>
      <div id="tournamentList"></div>
    </section>

    <!-- Refer & Earn -->
    <section id="refer" class="mt-12 card">
      <div class="section-title">Refer & Earn</div>
      <div class="label">Your Referral Code</div>
      <input id="refCode" class="input" readonly />
      <div class="row mt-8">
        <button id="shareWhatsApp" class="btn">WhatsApp</button>
        <button id="shareTelegram" class="btn">Telegram</button>
        <button id="copyLink" class="btn">Copy Link</button>
      </div>
      <div class="wallet mt-12">
        <div>
          <div class="label">Referral Credits</div>
          <div id="refCredits" class="brand" style="font-size:18px;">0</div>
        </div>
        <div class="label">Earn when friends sign up</div>
      </div>
    </section>

    <!-- Profile -->
    <section id="profile" class="mt-12 card">
      <div class="section-title">Profile</div>
      <div class="profile">
        <div class="avatar" id="avatarInitials">FF</div>
        <div>
          <div class="label">Player Name</div>
          <input id="playerName" class="input" placeholder="Your name" />
          <div class="label">Free Fire UID</div>
          <input id="playerFFUID" class="input" placeholder="123456789" />
        </div>
      </div>
      <div class="wallet mt-12">
        <div>
          <div class="label">Wallet Balance</div>
          <div id="walletBalance" class="brand" style="font-size:20px;">₹0</div>
        </div>
        <button id="btnTopUp" class="btn primary">Top-up</button>
      </div>
      <div class="mt-12">
        <div class="label">My Registrations</div>
        <div id="myRegistrations"></div>
      </div>
    </section>
  </main>

  <!-- Bottom Navigation -->
  <nav class="bottom">
    <button data-nav="home" class="active">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 11l9-7 9 7v8a2 2 0 0 1-2 2h-4v-6H9v6H5a2 2 0 0 1-2-2v-8z" stroke="currentColor" stroke-width="1.5"/></svg>
      Home
    </button>
    <button data-nav="tournaments">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 4h16v3H4zM6 7v7a6 6 0 0 0 12 0V7" stroke="currentColor" stroke-width="1.5"/></svg>
      Tournaments
    </button>
    <button data-nav="refer">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 10a5 5 0 0 1 10 0v1h1a3 3 0 1 1 0 6h-1M7 10v1H6a3 3 0 0 0 0 6h1" stroke="currentColor" stroke-width="1.5"/></svg>
      Refer
    </button>
    <button data-nav="profile">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5zm0 2c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5z" stroke="currentColor" stroke-width="1.5"/></svg>
      Profile
    </button>
  </nav>

  <!-- Registration Modal -->
  <div id="registerModal" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="section-title">Join Tournament</div>
      <div id="registerEventTitle" class="brand" style="font-size:18px;"></div>
      <div class="tourn-meta mt-8" id="registerEventMeta"></div>
      <div class="label mt-12">Player Name</div>
      <input id="regName" class="input" />
      <div class="label">Free Fire UID</div>
      <input id="regFFUID" class="input" />
      <div class="row mt-12" style="justify-content: space-between;">
        <div class="label">Entry Fee: <strong id="regEntryFee">₹0</strong></div>
        <div class="label">Wallet: <strong id="regWallet">₹0</strong></div>
      </div>
      <div class="row mt-12">
        <button class="btn" id="btnRegCancel">Cancel</button>
        <button class="btn primary" id="btnPayJoin">Pay & Join</button>
      </div>
      <div id="regSuccess" class="hidden mt-12">
        <div class="checkmark">
          <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 13l4 4L19 7" stroke="#065f46" stroke-width="2"/></svg>
        </div>
        <div class="brand" style="text-align:center;">Payment Success! You are in.</div>
      </div>
    </div>
  </div>

  <!-- Top-up Modal -->
  <div id="topupModal" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="section-title">Top-up Wallet</div>
      <div class="label">Amount (₹)</div>
      <input id="topupAmount" class="input" inputmode="numeric" placeholder="100" />
      <div class="row mt-12">
        <button class="btn" id="btnTopupCancel">Cancel</button>
        <button class="btn primary" id="btnTopupPay">Pay Now</button>
      </div>
      <div id="topupSuccess" class="hidden mt-12">
        <div class="checkmark">
          <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 13l4 4L19 7" stroke="#065f46" stroke-width="2"/></svg>
        </div>
        <div class="brand" style="text-align:center;">Wallet Recharged</div>
      </div>
    </div>
  </div>

  <script>
    // Lightweight state manager using localStorage for demo purposes
    const storage = {
      get(key, fallback) {
        try { const raw = localStorage.getItem(key); return raw ? JSON.parse(raw) : fallback; } catch { return fallback; }
      },
      set(key, value) { localStorage.setItem(key, JSON.stringify(value)); }
    };

    // Demo tournaments seed
    const defaultTournaments = [
      { id: 't001', title: 'Daily Clash', matchTime: new Date(Date.now()+60*60*1000).toISOString(), map: 'Bermuda', prize: 1000, entryFee: 30, roomId: '', roomPass: '', maxPlayers: 100, status: 'live', players: 36 },
      { id: 't002', title: 'Sunset Squad', matchTime: new Date(Date.now()+24*60*60*1000).toISOString(), map: 'Kalahari', prize: 1500, entryFee: 50, roomId: '', roomPass: '', maxPlayers: 120, status: 'upcoming', players: 58 },
      { id: 't003', title: 'Midnight Bash', matchTime: new Date(Date.now()-48*60*60*1000).toISOString(), map: 'Purgatory', prize: 2000, entryFee: 40, roomId: '', roomPass: '', maxPlayers: 100, status: 'past', players: 100 },
    ];

    // Initialize demo data if absent
    const tournaments = storage.get('tournaments', defaultTournaments);
    if (!localStorage.getItem('tournaments')) storage.set('tournaments', tournaments);

    // User bootstrap + referral tracking
    function generateId(prefix) { return prefix + Math.random().toString(36).slice(2, 10); }
    const url = new URL(location.href);
    const incomingRef = url.searchParams.get('ref');
    let user = storage.get('user', null);
    if (!user) {
      user = { id: generateId('u_'), name: 'Player', ffUid: '', walletBalance: 0, referralCredits: 0, referrer: incomingRef || null, registrations: {} };
      storage.set('user', user);
      // Track referral signup credit (demo)
      if (incomingRef) {
        const referrals = storage.get('referrals', []);
        referrals.push({ id: generateId('r_'), referrer: incomingRef, referee: user.id, timestamp: Date.now() });
        storage.set('referrals', referrals);
        // Add credit to referrer user snapshot (if exists locally)
        const maybeRefUser = storage.get('user_'+incomingRef, null);
        if (maybeRefUser) {
          maybeRefUser.referralCredits = (maybeRefUser.referralCredits||0) + 10;
          storage.set('user_'+incomingRef, maybeRefUser);
        }
      }
    }
    // Also mirror a copy for admin demo
    storage.set('users', { [user.id]: user, ...(storage.get('users', {})) });

    // UI helpers
    function rupee(amount) { return '₹' + Number(amount||0).toFixed(0); }
    function setText(id, value) { const el = document.getElementById(id); if (el) el.textContent = value; }
    function openModal(el) { el.classList.add('open'); }
    function closeModal(el) { el.classList.remove('open'); }
    function initialsFromName(name) { return (name||'P').trim().split(/\s+/).map(x=>x[0]).slice(0,2).join('').toUpperCase(); }

    // Navigation
    const sections = ['home','tournaments','refer','profile'];
    function showSection(id) {
      sections.forEach(s => {
        const el = document.getElementById(s);
        if (!el) return;
        if (s === id) el.classList.remove('hidden'); else el.classList.add('hidden');
      });
      document.querySelectorAll('nav.bottom button').forEach(b => b.classList.toggle('active', b.getAttribute('data-nav')===id));
      if (id === 'tournaments') renderTournaments(currentTab);
      if (id === 'refer') renderRefer();
      if (id === 'profile') renderProfile();
      location.hash = id;
    }
    document.querySelectorAll('nav.bottom button').forEach(btn => btn.addEventListener('click', () => showSection(btn.getAttribute('data-nav'))));

    // Hero CTA
    document.getElementById('playNow').addEventListener('click', () => showSection('tournaments'));
    document.getElementById('playNowTop').addEventListener('click', () => showSection('tournaments'));

    // Tabs and tournament rendering
    let currentTab = 'live';
    document.querySelectorAll('.tab-btn').forEach(btn => btn.addEventListener('click', () => {
      currentTab = btn.getAttribute('data-tab');
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b===btn));
      renderTournaments(currentTab);
    }));

    function renderTournaments(tab) {
      const list = document.getElementById('tournamentList');
      list.innerHTML = '';
      const data = storage.get('tournaments', []);
      const filtered = data.filter(t => t.status === tab);
      if (filtered.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'card';
        empty.textContent = 'No tournaments here yet.';
        list.appendChild(empty);
        return;
      }
      filtered.forEach(t => {
        const card = document.createElement('div');
        card.className = 'card tourn-card';
        const left = document.createElement('div');
        left.innerHTML = `
          <div class="brand" style="font-size:16px;">${t.title}</div>
          <div class="tourn-meta mt-8">
            <span class="pill">${new Date(t.matchTime).toLocaleString()}</span>
            <span class="pill">${t.map}</span>
            <span class="pill">Prize ${rupee(t.prize)}</span>
            <span class="pill">Entry ${rupee(t.entryFee)}</span>
            <span class="pill">${t.players||0}/${t.maxPlayers} joined</span>
          </div>`;
        const right = document.createElement('div');
        const btn = document.createElement('button');
        btn.className = 'join-btn';
        btn.textContent = 'Join';
        btn.disabled = (t.status==='past') || ((t.players||0) >= t.maxPlayers);
        btn.addEventListener('click', () => openRegisterModal(t));
        right.appendChild(btn);
        card.appendChild(left); card.appendChild(right);
        list.appendChild(card);
      });
    }

    // Registration flow
    const registerModal = document.getElementById('registerModal');
    const regName = document.getElementById('regName');
    const regFFUID = document.getElementById('regFFUID');
    const regEntryFee = document.getElementById('regEntryFee');
    const regWallet = document.getElementById('regWallet');
    const regSuccess = document.getElementById('regSuccess');
    let selectedTournament = null;

    function openRegisterModal(t) {
      selectedTournament = t;
      document.getElementById('registerEventTitle').textContent = t.title;
      document.getElementById('registerEventMeta').textContent = `${new Date(t.matchTime).toLocaleString()} • ${t.map}`;
      regName.value = storage.get('user', user).name || '';
      regFFUID.value = storage.get('user', user).ffUid || '';
      regEntryFee.textContent = rupee(t.entryFee);
      regWallet.textContent = rupee(storage.get('user', user).walletBalance || 0);
      regSuccess.classList.add('hidden');
      openModal(registerModal);
    }
    document.getElementById('btnRegCancel').addEventListener('click', () => closeModal(registerModal));

    async function handlePayAndJoin() {
      // Persist profile edits from modal
      user = storage.get('user', user);
      user.name = regName.value.trim() || user.name;
      user.ffUid = regFFUID.value.trim();
      storage.set('user', user);

      const fee = selectedTournament.entryFee;
      let balance = user.walletBalance || 0;
      if (balance < fee) {
        const shortfall = fee - balance;
        await processPayment(shortfall); // top-up just in time
        user = storage.get('user', user);
        balance = user.walletBalance;
      }
      // Deduct and register
      user.walletBalance = Math.max(0, (user.walletBalance||0) - fee);
      user.registrations[selectedTournament.id] = {
        joinedAt: Date.now(),
        title: selectedTournament.title,
        fee: fee
      };
      storage.set('user', user);
      // Mirror for admin demo
      const usersMap = storage.get('users', {}); usersMap[user.id] = user; storage.set('users', usersMap);
      const payments = storage.get('payments', []);
      payments.push({ id: generateId('p_'), userId: user.id, amount: fee, type: 'entry', tournId: selectedTournament.id, timestamp: Date.now() });
      storage.set('payments', payments);
      // Increase players count
      const ts = storage.get('tournaments', []);
      const idx = ts.findIndex(x => x.id === selectedTournament.id);
      if (idx >= 0) { ts[idx].players = (ts[idx].players||0)+1; storage.set('tournaments', ts); }
      regWallet.textContent = rupee(user.walletBalance);
      regSuccess.classList.remove('hidden');
      renderProfile();
      renderTournaments(currentTab);
      setTimeout(() => closeModal(registerModal), 900);
    }
    document.getElementById('btnPayJoin').addEventListener('click', () => { if (selectedTournament) handlePayAndJoin(); });

    // Payments
    async function processPayment(amount) {
      // Placeholder for Razorpay/Stripe SDK integration.
      // Example Razorpay (pseudo):
      // const rzp = new Razorpay({ key: 'rzp_key', amount: amount*100, currency: 'INR', handler: onSuccess }); rzp.open();
      await new Promise(res => setTimeout(res, 700)); // simulate network
      // On success: credit wallet
      user = storage.get('user', user);
      user.walletBalance = (user.walletBalance||0) + Number(amount||0);
      storage.set('user', user);
      const payments = storage.get('payments', []);
      payments.push({ id: generateId('p_'), userId: user.id, amount: amount, type: 'topup', timestamp: Date.now() });
      storage.set('payments', payments);
    }

    // Top-up modal
    const topupModal = document.getElementById('topupModal');
    const topupAmount = document.getElementById('topupAmount');
    const topupSuccess = document.getElementById('topupSuccess');
    document.getElementById('btnTopUp').addEventListener('click', () => { topupAmount.value = ''; topupSuccess.classList.add('hidden'); openModal(topupModal); });
    document.getElementById('btnTopupCancel').addEventListener('click', () => closeModal(topupModal));
    document.getElementById('btnTopupPay').addEventListener('click', async () => {
      const amt = Math.max(0, Number(topupAmount.value||0));
      if (!amt) return;
      await processPayment(amt);
      topupSuccess.classList.remove('hidden');
      setTimeout(() => { closeModal(topupModal); renderProfile(); }, 900);
    });

    // Refer & Earn rendering
    function renderRefer() {
      const me = storage.get('user', user);
      const code = me.id;
      document.getElementById('refCode').value = code;
      document.getElementById('refCredits').textContent = rupee(me.referralCredits||0);
    }
    function buildShareUrl() {
      const me = storage.get('user', user);
      const url = new URL(location.origin + location.pathname);
      url.searchParams.set('ref', me.id);
      return url.toString();
    }
    function nativeShareOrFallback(text) {
      const shareData = { title: 'Join Free Fire Tournaments', text, url: buildShareUrl() };
      if (navigator.share) navigator.share(shareData).catch(()=>{});
    }
    document.getElementById('shareWhatsApp').addEventListener('click', () => {
      const link = buildShareUrl();
      const msg = encodeURIComponent('Join me on Free Fire Tournaments: ' + link);
      nativeShareOrFallback('Join me on Free Fire Tournaments!');
      window.open('https://wa.me/?text=' + msg, '_blank');
    });
    document.getElementById('shareTelegram').addEventListener('click', () => {
      const link = buildShareUrl();
      nativeShareOrFallback('Join me on Free Fire Tournaments!');
      window.open('https://t.me/share/url?url=' + encodeURIComponent(link) + '&text=' + encodeURIComponent('Play & win!'), '_blank');
    });
    document.getElementById('copyLink').addEventListener('click', async () => {
      const link = buildShareUrl();
      try { await navigator.clipboard.writeText(link); alert('Link copied!'); } catch { prompt('Copy this link:', link); }
    });

    // Profile rendering
    function renderProfile() {
      const me = storage.get('user', user);
      document.getElementById('playerName').value = me.name || '';
      document.getElementById('playerFFUID').value = me.ffUid || '';
      document.getElementById('walletBalance').textContent = rupee(me.walletBalance||0);
      document.getElementById('avatarInitials').textContent = initialsFromName(me.name);
      const regsWrap = document.getElementById('myRegistrations');
      regsWrap.innerHTML = '';
      const entries = Object.entries(me.registrations||{});
      if (entries.length === 0) {
        const empty = document.createElement('div'); empty.className = 'label'; empty.textContent = 'You have not joined any tournament yet.'; regsWrap.appendChild(empty);
      } else {
        entries.forEach(([tid, r]) => {
          const row = document.createElement('div'); row.className = 'row'; row.style.justifyContent = 'space-between'; row.style.border = '1px solid var(--border)'; row.style.borderRadius = '10px'; row.style.padding = '8px 10px'; row.style.marginTop = '8px';
          const left = document.createElement('div'); left.innerHTML = `<div class="brand" style="font-size:14px;">${r.title}</div><div class="label">Paid ${rupee(r.fee)} • ${new Date(r.joinedAt).toLocaleString()}</div>`;
          const right = document.createElement('div'); const cancel = document.createElement('button'); cancel.className = 'btn'; cancel.textContent = 'Cancel'; cancel.addEventListener('click', () => cancelRegistration(tid, r)); right.appendChild(cancel);
          row.appendChild(left); row.appendChild(right); regsWrap.appendChild(row);
        });
      }
    }
    function cancelRegistration(tid, r) {
      if (!confirm('Cancel registration?')) return;
      user = storage.get('user', user);
      delete user.registrations[tid];
      // Refund 80% as policy demo
      user.walletBalance = (user.walletBalance||0) + Math.round((r.fee||0)*0.8);
      storage.set('user', user);
      const ts = storage.get('tournaments', []);
      const idx = ts.findIndex(x => x.id === tid);
      if (idx >= 0) { ts[idx].players = Math.max(0, (ts[idx].players||0)-1); storage.set('tournaments', ts); }
      renderProfile(); renderTournaments(currentTab);
    }

    // Persist profile edits inline
    document.getElementById('playerName').addEventListener('change', (e) => { user = storage.get('user', user); user.name = e.target.value; storage.set('user', user); renderProfile(); });
    document.getElementById('playerFFUID').addEventListener('change', (e) => { user = storage.get('user', user); user.ffUid = e.target.value; storage.set('user', user); });

    // Initial section based on hash
    const initial = sections.includes(location.hash.replace('#','')) ? location.hash.replace('#','') : 'home';
    sections.forEach((s,i) => { if (s!==initial) document.getElementById(s).classList.add('hidden'); });
    document.querySelectorAll('nav.bottom button').forEach(b => b.classList.toggle('active', b.getAttribute('data-nav')===initial));
    if (initial==='tournaments') renderTournaments(currentTab);
    if (initial==='refer') renderRefer();
    if (initial==='profile') renderProfile();

    // Firebase / Firestore config placeholder
    // firebase.initializeApp(firebaseConfig);
    // const db = firebase.firestore();
    // firebase.auth().onAuthStateChanged(user => { /* handle auth */ });
    // async function joinTournament(tournId, userId) {
    //   await processPayment(entryFee);
    //   await db.collection('tournaments').doc(tournId)
    //           .collection('registrations').add({ userId, timestamp: Date.now() });
    //   await db.collection('users').doc(userId).update({ walletBalance: newBalance });
    // }
  </script>
</body>
</html>

